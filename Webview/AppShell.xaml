<?xml version="1.0" encoding="utf-8" ?>
<Shell
    x:Class="Webview.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:Webview"
    BackgroundColor="White"
    ForegroundColor="Black"
    TitleColor="Black">


    <Shell.Resources>
        <!-- Parent items: Factories, Map, Overview, Utility -->
        <Style x:Key="SidebarParentLabel" TargetType="Label">
            <Setter Property="FontFamily" Value="Arial" />
            <Setter Property="FontSize"   Value="18" />
        </Style>

        <!-- Children: Factory-1..Factory-9 -->
        <Style x:Key="SidebarChildLabel" TargetType="Label">
            <Setter Property="FontFamily" Value="Arial" />
            <Setter Property="FontSize"   Value="16" />
        </Style>
    </Shell.Resources>
    
    <!-- Custom hamburger menu content -->
    <Shell.FlyoutContent>
        <ScrollView>
            <VerticalStackLayout Padding="0,0,0,24"
                             Spacing="8">

                <!-- Header -->
                <Label Text="Dashboards"
                   FontSize="24"
                   FontAttributes="Bold"
                   Padding="16,12,16,8" />

                <!-- Dashboards list -->
                <CollectionView x:Name="DashboardsList"
                            SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <StackLayout Spacing="0">
                                <!-- Parent item: Overview / Map / Factories / Utility -->
                                <Grid Padding="16,8"
                                  ColumnDefinitions="Auto,*,Auto">
                                    <!-- placeholder icon -->
                                    <Label Text="⬛"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       Margin="0,0,8,0" />

                                    <Label Grid.Column="1"
                                       Text="{Binding Name}"
                                       FontSize="20"
                                       VerticalOptions="Center">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnParentTapped" />
                                        </Label.GestureRecognizers>
                                    </Label>

                                    <!-- arrow shown only if there are children -->
                                    <Label Grid.Column="2"
                                       Text="▾"
                                       FontSize="16"
                                       VerticalOptions="Center"
                                       IsVisible="{Binding HasChildren}">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="OnParentTapped" />
                                        </Label.GestureRecognizers>
                                    </Label>
                                </Grid>

                                <!-- Children: e.g. Factory-1..Factory-9 under Factories -->
                                <VerticalStackLayout Margin="32,0,0,0"
                                                 IsVisible="{Binding IsExpanded}"
                                                 BindableLayout.ItemsSource="{Binding Children}">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Label Text="{Binding Name}"
                                               Padding="8,4"
                                               FontSize="18">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnChildTapped" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>
                            </StackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Sign out at bottom -->
                <Button Text="Sign out"
                    Margin="16,24,16,0"
                    HeightRequest="44"
                    CornerRadius="8"
                    FontSize="14"
                    HorizontalOptions="Fill"
                    Clicked="OnSignOutClicked" />
            </VerticalStackLayout>
        </ScrollView>
    </Shell.FlyoutContent>


    <!--<Shell.FlyoutContent>
        <Grid Padding="0" RowDefinitions="Auto,*">
            <Label Text="Dashboards"
                   FontSize="24"
                   FontAttributes="Bold"
                   Padding="16,12" />

            <CollectionView x:Name="DashboardsList"
                            Grid.Row="1"
                            SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <StackLayout Spacing="0">
                            --><!-- Parent item: Overview / Map / Factories / Utility -->
                            <!-- PARENT ROW: icon + label + arrow --><!--
                            <Grid Padding="16,8"
                                  ColumnDefinitions="Auto,*,Auto">
                                --><!-- placeholder icon (same for all for now) --><!--
                                <Label Text="⬛"
                                       FontSize="20"
                                       VerticalOptions="Center"
                                       Margin="0,0,8,0" />

                                <Label Grid.Column="1"
                                       Text="{Binding Name}"
                                       FontSize="20"
                                       VerticalOptions="Center">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnParentTapped" />
                                    </Label.GestureRecognizers>
                                </Label>

                                --><!-- static arrow shown only if there are children --><!--
                                <Label Grid.Column="2"
                                       Text="▾"
                                       FontSize="16"
                                       VerticalOptions="Center"
                                       IsVisible="{Binding HasChildren}">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnParentTapped" />
                                    </Label.GestureRecognizers>
                                </Label>
                            </Grid>

                            --><!-- Children: e.g. Factory-1..Factory-9 under Factories --><!--
                            <VerticalStackLayout Margin="32,0,0,0"
                                                    IsVisible="{Binding IsExpanded}"
                                                    BindableLayout.ItemsSource="{Binding Children}">
                                <BindableLayout.ItemTemplate>
                                    <DataTemplate>
                                        <Label Text="{Binding Name}"
                                               Padding="8,4"
                                               FontSize="18">
                                            <Label.GestureRecognizers>
                                                <TapGestureRecognizer Tapped="OnChildTapped" />
                                            </Label.GestureRecognizers>
                                        </Label>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </VerticalStackLayout>
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            --><!-- Footer: Sign out --><!--
            <Grid Grid.Row="2"
                  Padding="16,8">
                <Button Text="Sign out"
                        FontSize="14"
                        HorizontalOptions="Fill"
                        Clicked="OnSignOutClicked" />
            </Grid>
        </Grid>
    </Shell.FlyoutContent>-->

    <!-- FIRST page = startup page (Login) -->
    <ShellContent
        Route="LoginPage"
        ContentTemplate="{DataTemplate local:LoginPage}" />

    <!-- WebView host -->
    <ShellContent
        Title="Dashboards"
        Route="SingleWebView"
        ContentTemplate="{DataTemplate local:SingleWebView}" />

</Shell>



